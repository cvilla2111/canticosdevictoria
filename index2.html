<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cánticos de Victoria</title>
    
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'><path d='M18.7,5.1c-0.2-0.6-0.6-1.1-1.2-1.4c-0.9-0.5-2-0.6-2.9-0.1L11.8,5H6C3.8,5,2,6.8,2,9v7c0,2.2,1.8,4,4,4h6h6c2.2,0,4-1.8,4-4V9C22,7,20.6,5.4,18.7,5.1z' fill='%2346b961'/><path d='M11,18H6c-1.1,0-2-0.9-2-2V9c0-1.1,0.9-2,2-2h5V18z' fill='%2368c97f'/><path d='M15.3,16.2L13,17.4V6.6l2.6-1.3c0.4-0.2,0.8,0,1,0C16.7,5.5,17,5.7,17,6.2v7.3C17,14.7,16.4,15.7,15.3,16.2z' fill='%233b5e2f'/><path d='M20,16c0,1.1-0.9,2-2,2h-1.8c1.7-0.9,2.8-2.6,2.8-4.5V7.3c0.6,0.3,1,1,1,1.7V16z' fill='%23c7ce49'/></svg>" type="image/svg+xml">
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Chewy&family=Quicksand:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        // Tailwind Configuration
        tailwind.config = {
            darkMode: 'class',
            theme: {
                fontFamily: {
                    'sans': ['Quicksand', 'sans-serif'],
                    'headings': ['Chewy', 'cursive'],
                },
                extend: {
                    colors: {
                        primary: '#5D5CDE',
                    },
                    animation: {
                        'eq1': 'equalize 0.45s ease-in-out infinite alternate',
                        'eq2': 'equalize 0.38s ease-in-out infinite alternate',
                        'eq3': 'equalize 0.3s ease-in-out infinite alternate',
                        'eq4': 'equalize 0.42s ease-in-out infinite alternate',
                        'eq5': 'equalize 0.35s ease-in-out infinite alternate',
                        'eq6': 'equalize 0.4s ease-in-out infinite alternate'
                    },
                    keyframes: {
                        equalize: {
                            '0%': { height: '0%' },
                            '50%': { height: '75%' },
                            '100%': { height: '30%' }
                        }
                    }
                }
            }
        }

        // Theme management
        const storedTheme = localStorage.getItem('theme');
        const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
        
        if (storedTheme === 'dark' || (!storedTheme && systemDarkMode)) {
            document.documentElement.classList.add('dark');
        } else {
            document.documentElement.classList.remove('dark');
        }
        
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
            if (!localStorage.getItem('theme')) {
                if (event.matches) {
                    document.documentElement.classList.add('dark');
                } else {
                    document.documentElement.classList.remove('dark');
                }
            }
        });
    </script>
    <style>
        /* === ANIMATION KEYFRAMES === */
        /* Button animations */
        @keyframes pulseError {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        @keyframes buttonPulse {
            0% { transform: scale(1); box-shadow: 0 0 0 rgba(93, 92, 222, 0); }
            40% { transform: scale(0.88); box-shadow: 0 0 0 rgba(93, 92, 222, 0); }
            60% { transform: scale(1.15); box-shadow: 0 0 10px rgba(93, 92, 222, 0.5); }
            100% { transform: scale(1); box-shadow: 0 0 0 rgba(93, 92, 222, 0); }
        }
        
        /* Stop button animations */
        @keyframes bounceIn {
            0% { transform: translate(-50%, 100px); opacity: 0; }
            60% { transform: translate(-50%, -10px); opacity: 1; }
            80% { transform: translate(-50%, 5px); }
            100% { transform: translate(-50%, 0); }
        }
        
        @keyframes bounceOut {
            0% { transform: translate(-50%, 0); opacity: 1; }
            20% { transform: translate(-50%, 5px); opacity: 1; }
            100% { transform: translate(-50%, 100px); opacity: 0; }
        }
        
        /* Modal animations */
        @keyframes modalFadeIn {
            0% { opacity: 0; }
            100% { opacity: 1; }
        }
        
        @keyframes modalFadeOut {
            0% { opacity: 1; }
            100% { opacity: 0; }
        }
        
        @keyframes modalContentIn {
            0% { opacity: 0; transform: scale(0.9); }
            70% { opacity: 1; transform: scale(1.02); }
            100% { opacity: 1; transform: scale(1); }
        }
        
        @keyframes modalContentOut {
            0% { opacity: 1; transform: scale(1); }
            30% { opacity: 1; transform: scale(1.02); }
            100% { opacity: 0; transform: scale(0.9); }
        }
        
        /* === ANIMATION CLASSES === */
        .pulse-error { animation: pulseError 0.3s ease-in-out; }
        .button-pulse { animation: buttonPulse 0.4s cubic-bezier(0.36, 0.07, 0.19, 0.97) both; }
        .bounce-in { animation: bounceIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards; }
        .bounce-out { animation: bounceOut 0.4s cubic-bezier(0.6, -0.28, 0.735, 0.045) forwards; }
        .modal-fade-in { animation: modalFadeIn 0.3s ease-out forwards; }
        .modal-fade-out { animation: modalFadeOut 0.3s ease-in forwards; }
        .modal-content-in { animation: modalContentIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards; }
        .modal-content-out { animation: modalContentOut 0.3s ease-in forwards; }

        /* === AUDIO BUTTON STATES === */
        .audio-unavailable {
            position: relative;
        }
        
        .audio-unavailable svg.play-button {
            color: #888888 !important;
            stroke: #888888 !important;
        }
        
        .audio-unavailable svg.play-button rect {
            fill: rgba(136, 136, 136, 0.15) !important;
        }
        
        .audio-unavailable svg.play-button path {
            fill: #888888 !important;
        }
        
        .audio-unavailable::after {
            content: '✕';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 24px;
            color: white;
            font-weight: bold;
            z-index: 5;
            text-shadow: 0px 0px 2px rgba(0,0,0,0.5);
        }
        
        .audio-unavailable .play-button {
            cursor: not-allowed;
        }
        
        /* Button styling */
        .play-button-container {
            transition: transform 0.2s ease;
            transform-origin: center;
        }
        
        .close-button-effect {
            transition: transform 0.2s, background-color 0.2s;
        }
        
        .close-button-effect:active {
            transform: scale(0.85);
        }
        
        .metronome-button-effect {
            transition: transform 0.2s, color 0.2s;
        }
        
        .metronome-button-effect:active {
            transform: scale(0.9);
        }
        
        /* Base sunken effect for all clave buttons */
        .tab-btn {
            box-shadow: 
                inset 0 1px 1px rgba(0, 0, 0, 0.2),
                inset 0 2px 5px rgba(0, 0, 0, 0.15),
                inset 0 -1px 1px rgba(255, 255, 255, 0.6);
            background-color: #e5e7eb; /* gray-200 */
            color: #374151; /* gray-700 */
        }
        
        /* Dark mode support for base buttons */
        .dark .tab-btn {
            box-shadow: 
                inset 0 1px 2px rgba(0, 0, 0, 0.4),
                inset 0 2px 5px rgba(0, 0, 0, 0.3),
                inset 0 -1px 1px rgba(255, 255, 255, 0.05);
            background-color: #4b5563; /* gray-600 */
            color: #d1d5db; /* gray-300 */
        }
        
        /* Active state with fill change */
        .tab-btn.active-fill {
            background: linear-gradient(to bottom, 
                rgba(255, 255, 255, 0.95), 
                rgba(255, 255, 255, 0.85)
            );
            color: #ef4444; /* red-500 */
            font-weight: 600;
            box-shadow: 
                inset 0 1px 1px rgba(0, 0, 0, 0.1),
                inset 0 2px 3px rgba(0, 0, 0, 0.05);
        }
        
        /* Dark mode support for active state */
        .dark .tab-btn.active-fill {
            background: linear-gradient(to bottom, 
                rgba(31, 41, 55, 0.95), 
                rgba(31, 41, 55, 0.85)
            );
            color: #f87171; /* red-400 */
            box-shadow: 
                inset 0 1px 1px rgba(0, 0, 0, 0.2),
                inset 0 2px 3px rgba(0, 0, 0, 0.1);
        }
        
        /* Alphabet handle - touch area */
        .alphabet-handle {
            position: fixed;
            right: 0;
            top: 50%;
            transform: translateY(-50%);
            width: 40px;  /* Touch area width */
            height: 70%;
            z-index: 40;
            user-select: none;
            -webkit-user-select: none;
            touch-action: none;
        }
        
        /* Handle indicator - half-pill shape */
        .handle-indicator {
            width: 36px;
            height: 36px;
            position: absolute;
            right: 0; /* Flush with screen edge */
            border: 2px solid #1f2937; /* gray-800 - match text color */
            border-right: none; /* Remove right border since it's against screen edge */
            border-radius: 18px 0 0 18px; /* Half-pill shape: rounded left, flat right */
            display: flex;
            align-items: center;
            justify-content: center;
            padding-right: 4px; /* Adjust text position slightly */
            color: #1f2937; /* Match text color */
            font-weight: bold;
            font-size: 16px;
            transition: all 0.3s ease; /* Smooth transition */
            touch-action: none;
            background: rgba(255, 255, 255, 0.9);
            box-shadow: -2px 2px 8px rgba(0,0,0,0.15); /* Shadow only on left side */
            opacity: 0; /* Hidden by default */
            transform: scale(0.9) translateX(10px); /* Slightly scaled down and shifted */
            pointer-events: none; /* Don't respond to events when hidden */
        }
        
        .dark .handle-indicator {
            border-color: #e5e7eb; /* gray-200 - match dark mode text */
            color: #e5e7eb; /* Match dark mode text */
            background: rgba(31, 41, 55, 0.9);
            box-shadow: -2px 2px 8px rgba(0,0,0,0.3);
        }
        
        /* Visible state */
        .handle-indicator.visible {
            opacity: 1;
            transform: scale(1) translateX(0);
            pointer-events: auto; /* Respond to events when visible */
        }
        
        .handle-indicator.active {
            transform: scale(1.1) !important; /* Override any transform */
            border-width: 2.5px; /* Slightly thicker for active state */
            border-right: none; /* Keep right side flat */
            box-shadow: -3px 2px 10px rgba(0, 0, 0, 0.3);
            opacity: 1 !important; /* Ensure visibility */
        }
        
        .dark .handle-indicator.active {
            box-shadow: -3px 2px 10px rgba(255, 255, 255, 0.2);
        }
        
        /* Current letter display */
        .letter-display {
            position: fixed;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            width: 100px;
            height: 100px;
            background: rgba(31, 41, 55, 0.9); /* Match text color */
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 48px;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.2s;
            z-index: 50;
        }
        
        .dark .letter-display {
            background: rgba(229, 231, 235, 0.9); /* Light background in dark mode */
            color: #1f2937; /* Dark text on light background */
        }
        
        .letter-display.visible {
            opacity: 1;
        }
        
        /* Section headers */
        .section-header {
            position: sticky;
            top: 0;
            background: #f9fafb;
            padding: 8px 16px;
            font-weight: bold;
            font-size: 18px;
            z-index: 10;
            box-shadow: 0 1px 2px rgba(0,0,0,0.05);
        }
        
        .dark .section-header {
            background: #374151;
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body class="min-h-screen bg-white dark:bg-gray-900 text-gray-800 dark:text-gray-200 transition-colors duration-200">
    <div class="container mx-auto px-2 sm:px-3 pt-10 pb-20 max-w-md md:max-w-lg lg:max-w-2xl xl:max-w-4xl 2xl:max-w-6xl min-h-screen flex flex-col">
        <!-- Main Content Area -->
        <div>
            <!-- App Header -->
            <h1 class="text-4xl md:text-5xl lg:text-6xl xl:text-7xl font-bold mb-0 text-gray-800 dark:text-gray-200 text-center font-headings">Cánticos de Victoria</h1>
            <p id="subtitle" class="mb-2 text-sm md:text-base lg:text-lg xl:text-xl text-gray-600 dark:text-gray-400 text-center">Una colección de coritos</p>
            
            <!-- Search Bar -->
            <div id="searchBarContainer" class="sticky top-0 z-20 bg-white dark:bg-gray-900 pt-2 pb-1 mb-4 transition-shadow duration-300">
                <div class="relative">
                    <input type="text" id="searchInput" class="w-full px-4 py-2 pr-10 border border-gray-300 dark:border-gray-600 rounded-full bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-300 focus:outline-none focus:ring-1 focus:ring-primary focus:border-primary transition-colors text-base md:text-lg lg:text-xl" placeholder="Search...">
                    <div class="absolute inset-y-0 right-0 flex items-center pr-3 text-gray-400 dark:text-gray-500">
                        <!-- Search icon -->
                        <svg id="searchIcon" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                        </svg>
                        
                        <!-- Clear search icon -->
                        <svg id="clearSearchIcon" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 hidden cursor-pointer hover:text-gray-600 dark:hover:text-gray-300" fill="none" viewBox="0 0 24 24" stroke="currentColor" onclick="clearSearch()">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                        </svg>
                    </div>
                </div>
                <p id="noResults" class="mt-2 text-sm md:text-base lg:text-lg text-red-500 dark:text-red-400 text-center hidden">No se encontraron resultados</p>
            </div>
            
            <!-- Loading Indicator -->
            <div id="loadingIndicator" class="flex items-center justify-center py-4">
                <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-primary" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
                <span class="md:text-lg lg:text-xl">Cargando cánticos...</span>
            </div>
            
            <!-- Error Message -->
            <div id="errorMessage" class="hidden py-4 px-4 bg-red-50 dark:bg-red-900/20 text-red-600 dark:text-red-400 rounded-lg mb-4">
                <p class="md:text-lg lg:text-xl">Error al cargar el archivo de cánticos. Por favor, verifique que exista el archivo "canticos.txt" en el directorio raíz.</p>
            </div>
            
            <!-- Item List -->
            <ul id="itemList" class="bg-white dark:bg-gray-800 rounded-lg overflow-hidden shadow-md cursor-pointer">
                <!-- Items will be populated dynamically -->
            </ul>
        </div>
        
        <!-- Footer -->
        <footer class="mt-auto pt-8 pb-4 text-center text-sm text-gray-500 dark:text-gray-400">
            <!-- Theme Toggle Switch -->
            <div class="flex justify-center items-center mb-3">
                <span class="mr-2 text-yellow-500">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" />
                    </svg>
                </span>
                <div class="relative inline-block w-10 mr-2 align-middle select-none transition duration-200 ease-in">
                    <input type="checkbox" name="toggle" id="themeToggle" class="absolute block w-6 h-6 rounded-full bg-white border-4 border-gray-300 appearance-none cursor-pointer focus:outline-none checked:right-0 checked:border-gray-700 dark:checked:border-gray-200 focus:ring-0 transition-all duration-200" />
                    <label for="themeToggle" class="block overflow-hidden h-6 rounded-full bg-gray-300 dark:bg-gray-700 cursor-pointer"></label>
                </div>
                <span class="ml-2 text-blue-900 dark:text-blue-300">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" />
                    </svg>
                </span>
            </div>
            
            <p class="md:text-base lg:text-lg">Work in progress ɔ 2025 Cánticos De Victoria. <span class="text-green-600 dark:text-green-500">Ministerio Monte de Dios</span>. Manatí, P.R.</p>
        </footer>
    </div>

    <!-- Alphabet Handle -->
    <div id="alphabetHandle" class="alphabet-handle">
        <div id="handleIndicator" class="handle-indicator">A</div>
    </div>
    
    <!-- Letter Display (shows when scrolling the handle) -->
    <div id="letterDisplay" class="letter-display">A</div>

    <!-- Modal -->
    <div id="modal" class="fixed inset-0 z-50 hidden bg-black bg-opacity-75 flex items-center justify-center p-4 sm:p-2">
        <div style="border-radius: 8px !important; overflow: hidden;" class="bg-white dark:bg-gray-800 shadow-xl max-w-md md:max-w-2xl lg:max-w-3xl xl:max-w-4xl 2xl:max-w-[75vw] w-full max-h-[80vh] flex flex-col">
            <!-- Fixed Header -->
            <div class="px-3 pt-5 pb-3 sticky top-0 bg-white dark:bg-gray-800 z-10">
                <div class="flex">
                    <!-- Play button for the modal -->
                    <div class="relative h-10 w-10 mr-3 flex-shrink-0 cursor-pointer play-button-container -mt-1" id="modalPlayButtonContainer">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 text-gray-900 dark:text-gray-100 play-button" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" id="modalPlayButton">
                            <rect x="3" y="3" width="18" height="18" rx="2" ry="2" fill="white" class="dark:fill-gray-800" />
                            <path class="play-icon" d="M10 8l6 4-6 4V8z" fill="currentColor" />
                        </svg>
                        
                        <!-- Equalizer animation (hidden by default) -->
                        <div class="absolute inset-0 pointer-events-none hidden" id="modalEqualizer">
                            <div class="absolute bottom-2 left-0 right-0 flex items-end justify-center h-[calc(100%-8px)]">
                                <div class="eq-bar bg-red-500 bg-opacity-75 w-[3px] mx-[0.4px] h-0 animate-eq1"></div>
                                <div class="eq-bar bg-red-500 bg-opacity-75 w-[3px] mx-[0.4px] h-0 animate-eq2"></div>
                                <div class="eq-bar bg-red-500 bg-opacity-75 w-[3px] mx-[0.4px] h-0 animate-eq3"></div>
                                <div class="eq-bar bg-red-500 bg-opacity-75 w-[3px] mx-[0.4px] h-0 animate-eq4"></div>
                                <div class="eq-bar bg-red-500 bg-opacity-75 w-[3px] mx-[0.4px] h-0 animate-eq5"></div>
                                <div class="eq-bar bg-red-500 bg-opacity-75 w-[3px] mx-[0.4px] h-0 animate-eq6"></div>
                            </div>
                        </div>
                    </div>
                    <div class="pl-1 pr-6 flex-1 flex items-center self-center min-h-[40px] -mt-1">
                        <h3 id="modalTitle" class="text-base md:text-lg lg:text-xl xl:text-2xl font-bold text-gray-800 dark:text-gray-200 leading-tight"></h3>
                    </div>
                    <button id="closeModalBtn" onclick="closeModal()" class="w-6 h-6 flex items-center justify-center rounded-full bg-gray-400 dark:bg-gray-600 text-white hover:bg-gray-500 hover:dark:bg-gray-500 transition-colors duration-200 focus:outline-none flex-shrink-0 self-start -mt-2 close-button-effect">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-3.5 w-3.5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                        </svg>
                    </button>
                </div>
            </div>
            
            <!-- Scrollable Content Area -->
            <div class="flex-1 overflow-y-auto px-3 py-3 md:py-4 lg:py-5 xl:py-6 flex justify-center" id="scrollableContent">
                <div class="w-full text-center max-w-3xl">
                    <p id="modalContent" class="text-gray-800 dark:text-gray-200 text-lg md:text-xl lg:text-2xl xl:text-3xl 2xl:text-4xl text-left font-medium inline-block"></p>
                </div>
            </div>
            
            <!-- Fixed Footer -->
            <div class="px-3 py-3 sticky bottom-0 bg-white dark:bg-gray-800 z-10">
                <div class="flex justify-end">
                    <div class="inline-flex rounded-md p-0.5 h-7">
                        <button id="metronomeButton220" onclick="toggleMetronome(220)" class="tab-btn min-w-[45px] px-4 h-full flex items-center justify-center text-sm font-medium rounded transition-all hover:bg-white dark:hover:bg-gray-600 focus:outline-none relative mx-0.5 metronome-button-effect">
                            220
                        </button>
                        <button id="metronomeButton240" onclick="toggleMetronome(240)" class="tab-btn min-w-[45px] px-4 h-full flex items-center justify-center text-sm font-medium rounded transition-all hover:bg-white dark:hover:bg-gray-600 focus:outline-none relative mx-0.5 metronome-button-effect">
                            240
                        </button>
                        <button id="metronomeButton260" onclick="toggleMetronome(260)" class="tab-btn min-w-[45px] px-4 h-full flex items-center justify-center text-sm font-medium rounded transition-all hover:bg-white dark:hover:bg-gray-600 focus:outline-none relative mx-0.5 metronome-button-effect">
                            260
                        </button>
                        <button id="metronomeButton280" onclick="toggleMetronome(280)" class="tab-btn min-w-[45px] px-4 h-full flex items-center justify-center text-sm font-medium rounded transition-all hover:bg-white dark:hover:bg-gray-600 focus:outline-none relative mx-0.5 metronome-button-effect">
                            280
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Fixed Stop Button -->
    <div id="fixedStopButton" class="fixed bottom-5 left-1/2 transform -translate-x-1/2 w-14 h-14 rounded-full bg-red-500 shadow-xl flex items-center justify-center cursor-pointer z-50 hidden transition-all duration-300 hover:scale-110 active:scale-95" onclick="stopCurrentAudio()">
        <div class="w-5 h-5 bg-white rounded-sm"></div>
    </div>
    
    <!-- Return to Top Button -->
    <div id="returnToTopBtn" class="fixed bottom-5 right-5 w-10 h-10 cursor-pointer z-40 shadow-md rounded-full bg-white dark:bg-gray-800 transition-all duration-300 opacity-0 invisible hover:scale-110 active:scale-95 flex items-center justify-center" onclick="scrollToTop()">
        <div class="w-7 h-7">
            <svg width="100%" height="100%" fill="none" stroke-linecap="square" stroke-miterlimit="10" version="1.1" viewBox="0 0 510.2 411.55" xmlns="http://www.w3.org/2000/svg" class="up-icon">
                <defs>
                    <clipPath id="clipPath411-up">
                        <path d="m129.72-5.7707h800v600h-800z"/>
                    </clipPath>
                    <clipPath id="clipPath417-up">
                        <path d="m129.72-5.7707h800v600h-800z"/>
                    </clipPath>
                    <clipPath id="clipPath423-up">
                        <path d="m129.72-5.7707h800v600h-800z"/>
                    </clipPath>
                </defs>
                <g fill-rule="evenodd">
                    <path transform="translate(-133.27 -88.454)" d="m376.97 88.454c-57.43 69.504-138.67 206.23-243.7 411.55h510.2c-93.146-103.81-182.14-240.98-266.49-411.55z" clip-path="url(#clipPath423-up)" fill="#46b961"/>
                    <path transform="translate(-133.27 -88.454)" d="m376.97 205.97c-28.441 8.7006-109.68 106.54-243.7 294.03h510.2c-107.62-134.9-196.63-233.21-266.49-294.03z" clip-path="url(#clipPath417-up)" fill="#3b5e2f"/>
                    <path transform="translate(-133.27 -88.454)" d="m243.99 205.97c-46.564 87.807-83.811 185.65-110.72 294.03 37.776-9.3852 99.08-14.061 184.08-14.061 84.983 0 193.64 4.6759 326.12 14.061-99.345-39.328-232.33-137.19-399.48-294.03z" clip-path="url(#clipPath411-up)" fill="#c7ce49"/>
                </g>
            </svg>
        </div>
    </div>
    
    <!-- Hidden Audio Element for Clave -->
    <audio id="claveAudio" preload="auto" loop>
        <source src="clave240bpm.mp3" type="audio/mpeg">
    </audio>

    <script>
        // Sample data for songs by letter (this would be replaced by your actual data)
        const songsByLetter = {
            'A': [
                'Alabanza y adoración', 'Al Rey de reyes', 'Aleluya Cristo vive',
                'Alaba a Jehová', 'Amor eterno', 'Abre mis ojos', 'Alza tus manos'
            ],
            'B': [
                'Bendito sea el Señor', 'Buscad primero', 'Brilla Jesús', 'Bendición y honra'
            ],
            'C': [
                'Cristo te ama', 'Caminando voy', 'Cantaré de tu amor', 'Cordero de Dios',
                'Cuando el pueblo de Dios ora', 'Cambiame Señor'
            ],
            'D': [
                'Digno es el Cordero', 'Dios incomparable', 'Dame un nuevo corazón'
            ],
            'E': [
                'El gozo del Señor', 'Eres mi protector', 'En la cruz', 'El Señor es mi pastor', 
                'En tu presencia', 'Eres tú'
            ],
            'F': [
                'Fluye en mí', 'Fiel y verdadero', 'Fuente de vida'
            ],
            'G': [
                'Grande es el Señor', 'Glorioso', 'Gracias Señor', 'Gloria a Dios'
            ],
            'H': [
                'Hosanna', 'Hay poder', 'Hoy te rindo mi ser', 'Hermoso eres tú'
            ],
            'I': [
                'Incomparable', 'Iglesia gloriosa', 'Invencible es mi Dios'
            ],
            'J': [
                'Jesucristo es el Señor', 'Jehová es mi guerrero', 'Junto a tus pies'
            ],
            'L': [
                'La alegría del Señor', 'Levanto mis manos', 'Los que esperan en Jehová'
            ],
            'M': [
                'Mi salvador vive', 'Majestuoso', 'Milagroso Dios', 'Mi universo'
            ],
            'N': [
                'No hay nadie como tú', 'Nada es imposible', 'Nadie como tú'
            ],
            'P': [
                'Poderoso Dios', 'Paz en la tormenta', 'Por siempre te alabaré'
            ],
            'R': [
                'Rey de reyes', 'Renuévame', 'Roca eterna', 'Río de adoración'
            ],
            'S': [
                'Santo es el Señor', 'Solo Cristo', 'Soy libre', 'Santo Espíritu',
                'Sublime gracia', 'Sana nuestra tierra'
            ],
            'T': [
                'Tú eres santo', 'Te alabaré', 'Tú me sostendrás', 'Tu nombre levantaré'
            ],
            'V': [
                'Vine a adorarte', 'Vencedor', 'Vivo por fe', 'Victoria en Cristo'
            ],
            'Y': [
                'Yo te busco', 'Yo soy libre', 'Yo te exaltaré'
            ]
        };

        // DOM elements
        const itemList = document.getElementById('itemList');
        const searchInput = document.getElementById('searchInput');
        const clearSearchIcon = document.getElementById('clearSearchIcon');
        const searchIcon = document.getElementById('searchIcon');
        const loadingIndicator = document.getElementById('loadingIndicator');
        const errorMessage = document.getElementById('errorMessage');
        const noResults = document.getElementById('noResults');
        const themeToggle = document.getElementById('themeToggle');
        const returnToTopBtn = document.getElementById('returnToTopBtn');
        const alphabetHandle = document.getElementById('alphabetHandle');
        const handleIndicator = document.getElementById('handleIndicator');
        const letterDisplay = document.getElementById('letterDisplay');
        
        // Modal elements
        const modal = document.getElementById('modal');
        const modalTitle = document.getElementById('modalTitle');
        const modalContent = document.getElementById('modalContent');
        
        // Available letters for navigation
        const availableLetters = Object.keys(songsByLetter).sort();
        
        // Alphabet handle state variables
        let isDragging = false;
        let currentLetterIndex = 0;
        let handleY = 0;
        let scrollTimeout = null;
        let isScrolling = false;
        
        // Update subtitle with number of songs
        function updateSubtitle() {
            let totalSongs = 0;
            for (const letter in songsByLetter) {
                totalSongs += songsByLetter[letter].length;
            }
            document.getElementById('subtitle').textContent = `Una colección de ${totalSongs} coritos`;
        }
        
        // Generate content list with sections
        function generateContentList() {
            let html = '';
            
            availableLetters.forEach(letter => {
                const songs = songsByLetter[letter];
                
                // Create section header
                html += `<div id="section-${letter}" class="section-header sticky top-[45px] z-10">${letter}</div>`;
                
                // Create songs list
                html += '<div class="py-1">';
                songs.forEach(song => {
                    html += `
                        <li class="py-2 px-3 flex items-center border-b border-gray-200 dark:border-gray-700 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors" data-title="${song}" onclick="openModal('${song}')">
                            <div class="relative h-8 w-8 mr-3 flex-shrink-0 play-button-container">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-gray-900 dark:text-gray-100 play-button" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
                                    <rect x="3" y="3" width="18" height="18" rx="2" ry="2" fill="white" class="dark:fill-gray-800" />
                                    <path d="M10 8l6 4-6 4V8z" fill="currentColor" />
                                </svg>
                            </div>
                            <span class="font-medium md:text-lg lg:text-xl">${song}</span>
                        </li>
                    `;
                });
                html += '</div>';
            });
            
            itemList.innerHTML = html;
            hideLoading();
            updateSubtitle();
        }
        
        // Hide loading indicator
        function hideLoading() {
            loadingIndicator.classList.add('hidden');
        }
        
        // Show error message
        function showError() {
            errorMessage.classList.remove('hidden');
            hideLoading();
        }
        
        // Clear search
        function clearSearch() {
            searchInput.value = '';
            searchInput.dispatchEvent(new Event('input'));
            searchInput.focus();
        }
        
        // Search functionality
        function setupSearch() {
            searchInput.addEventListener('input', function() {
                const searchTerm = this.value.toLowerCase();
                
                // Show/hide clear icon
                if (searchTerm) {
                    searchIcon.classList.add('hidden');
                    clearSearchIcon.classList.remove('hidden');
                } else {
                    searchIcon.classList.remove('hidden');
                    clearSearchIcon.classList.add('hidden');
                }
                
                // Get all list items
                const listItems = document.querySelectorAll('#itemList li');
                const sectionHeaders = document.querySelectorAll('#itemList > div');
                
                // Hide all section headers initially
                sectionHeaders.forEach(header => {
                    header.classList.add('hidden');
                });
                
                // Track which letters have visible items
                const lettersWithVisibleItems = new Set();
                
                // Filter items
                let hasVisibleItems = false;
                listItems.forEach(item => {
                    const text = item.textContent.toLowerCase();
                    const letter = text.trim()[0].toUpperCase();
                    
                    if (searchTerm === '' || text.includes(searchTerm)) {
                        item.classList.remove('hidden');
                        hasVisibleItems = true;
                        
                        // Track which letter has visible items
                        if (letter) {
                            lettersWithVisibleItems.add(letter);
                        }
                        
                        // Show the corresponding section header
                        const sectionHeader = document.getElementById(`section-${letter}`);
                        if (sectionHeader) {
                            sectionHeader.classList.remove('hidden');
                        }
                    } else {
                        item.classList.add('hidden');
                    }
                });
                
                // Show/hide no results message
                if (!hasVisibleItems && searchTerm !== '') {
                    noResults.classList.remove('hidden');
                } else {
                    noResults.classList.add('hidden');
                }
                
                // Update alphabet handle letters based on search results
                updateAlphabetHandleLetters(lettersWithVisibleItems);
            });
        }
        
        // Update alphabet handle letters based on search results
        function updateAlphabetHandleLetters(visibleLetters) {
            // Hide handle indicator if no letters are visible
            if (visibleLetters.size === 0) {
                handleIndicator.classList.remove('visible');
                return;
            }
            
            // Update the current letter index if current letter is no longer visible
            const currentLetter = availableLetters[currentLetterIndex];
            if (!visibleLetters.has(currentLetter)) {
                // Find the first visible letter
                for (let i = 0; i < availableLetters.length; i++) {
                    if (visibleLetters.has(availableLetters[i])) {
                        currentLetterIndex = i;
                        break;
                    }
                }
            }
            
            // Update the handle indicator position
            positionIndicator(currentLetterIndex);
        }
        
        // Theme toggle functionality
        function setupThemeToggle() {
            // Set initial state based on current theme
            themeToggle.checked = document.documentElement.classList.contains('dark');
            
            themeToggle.addEventListener('change', function() {
                if (this.checked) {
                    document.documentElement.classList.add('dark');
                    localStorage.setItem('theme', 'dark');
                } else {
                    document.documentElement.classList.remove('dark');
                    localStorage.setItem('theme', 'light');
                }
            });
        }
        
        // Scroll to top
        function scrollToTop() {
            window.scrollTo({
                top: 0,
                behavior: 'smooth'
            });
        }
        
        // Handle scroll events
        function handleScroll() {
            // Show/hide return to top button
            if (window.scrollY > 300) {
                returnToTopBtn.classList.remove('opacity-0', 'invisible');
                returnToTopBtn.classList.add('opacity-100');
            } else {
                returnToTopBtn.classList.remove('opacity-100');
                returnToTopBtn.classList.add('opacity-0');
                setTimeout(() => {
                    if (window.scrollY <= 300) {
                        returnToTopBtn.classList.add('invisible');
                    }
                }, 300);
            }
            
            // Show alphabet handle when scrolling
            showHandleIndicator();
            isScrolling = true;
            
            // Clear existing timeout
            clearTimeout(scrollTimeout);
            
            // Set timeout to hide handle after scrolling stops
            scrollTimeout = setTimeout(function() {
                isScrolling = false;
                hideHandleIndicator();
            }, 1500); // Hide after 1.5 seconds of no scrolling
            
            // Update current letter based on visible sections
            updateCurrentLetterFromScroll();
        }
        
        // Alphabet Handle Functions
        
        // Set up handle position and size
        function setupHandle() {
            // Position the indicator for the first letter
            positionIndicator(0);
        }
        
        // Show handle indicator
        function showHandleIndicator() {
            handleIndicator.classList.add('visible');
        }
        
        // Hide handle indicator
        function hideHandleIndicator() {
            // Only hide if not dragging
            if (!isDragging) {
                handleIndicator.classList.remove('visible');
            }
        }
        
        // Position the indicator based on letter index
        function positionIndicator(index) {
            if (index < 0) index = 0;
            if (index >= availableLetters.length) index = availableLetters.length - 1;
            
            currentLetterIndex = index;
            const letter = availableLetters[index];
            
            // Update indicator letter
            handleIndicator.textContent = letter;
            letterDisplay.textContent = letter;
            
            // Calculate position based on index
            const handleHeight = alphabetHandle.clientHeight;
            const indicatorHeight = handleIndicator.clientHeight;
            const maxY = handleHeight - indicatorHeight;
            const ratio = index / (availableLetters.length - 1);
            const y = ratio * maxY;
            
            // Update position
            handleIndicator.style.top = `${y}px`;
            handleY = y;
        }
        
        // Scroll to a section
        function scrollToSection(letter) {
            const section = document.getElementById(`section-${letter}`);
            if (section) {
                section.scrollIntoView({ behavior: 'smooth' });
            }
        }
        
        // Calculate letter index from Y position
        function getLetterIndexFromY(y) {
            const handleHeight = alphabetHandle.clientHeight;
            const indicatorHeight = handleIndicator.clientHeight;
            const maxY = handleHeight - indicatorHeight;
            
            // Ensure y is within bounds
            y = Math.max(0, Math.min(maxY, y));
            
            // Calculate ratio of position
            const ratio = y / maxY;
            
            // Calculate letter index
            const index = Math.round(ratio * (availableLetters.length - 1));
            return index;
        }
        
        // Show letter display
        function showLetterDisplay() {
            letterDisplay.classList.add('visible');
        }
        
        // Hide letter display
        function hideLetterDisplay() {
            letterDisplay.classList.remove('visible');
        }
        
        // Update the current letter indicator based on scroll position
        function updateCurrentLetterFromScroll() {
            const sections = document.querySelectorAll('.section-header:not(.hidden)');
            let currentSection = null;
            
            // Find the section near the top of the viewport
            sections.forEach(section => {
                const rect = section.getBoundingClientRect();
                if (rect.top <= 180) {
                    currentSection = section;
                }
            });
            
            // If found a visible section, update the indicator
            if (currentSection) {
                const letter = currentSection.id.split('-')[1];
                const index = availableLetters.indexOf(letter);
                if (index !== -1) {
                    // Only update position, don't scroll again
                    currentLetterIndex = index;
                    handleIndicator.textContent = letter;
                    
                    // Calculate position based on index
                    const handleHeight = alphabetHandle.clientHeight;
                    const indicatorHeight = handleIndicator.clientHeight;
                    const maxY = handleHeight - indicatorHeight;
                    const ratio = index / (availableLetters.length - 1);
                    const y = ratio * maxY;
                    
                    // Update position
                    handleIndicator.style.top = `${y}px`;
                    handleY = y;
                }
            }
        }
        
        // Touch event handlers
        function handleTouchStart(e) {
            // Only react if handle is visible or we're already dragging
            if (!handleIndicator.classList.contains('visible') && !isDragging) {
                showHandleIndicator();
                // Give a small delay before processing the touch
                setTimeout(() => {
                    processTouchStart(e);
                }, 50);
            } else {
                processTouchStart(e);
            }
        }
        
        function processTouchStart(e) {
            e.preventDefault();
            handleIndicator.classList.add('active');
            isDragging = true;
            
            // Get touch position relative to handle
            const touch = e.touches[0];
            const handleRect = alphabetHandle.getBoundingClientRect();
            const y = touch.clientY - handleRect.top;
            
            // Update letter based on position
            const index = getLetterIndexFromY(y);
            positionIndicator(index);
            scrollToSection(availableLetters[index]);
            
            // Show letter display
            showLetterDisplay();
        }
        
        function handleTouchMove(e) {
            if (!isDragging) return;
            e.preventDefault();
            
            // Get touch position relative to handle
            const touch = e.touches[0];
            const handleRect = alphabetHandle.getBoundingClientRect();
            const y = touch.clientY - handleRect.top;
            
            // Update letter based on position
            const index = getLetterIndexFromY(y);
            positionIndicator(index);
            scrollToSection(availableLetters[index]);
        }
        
        function handleTouchEnd(e) {
            handleIndicator.classList.remove('active');
            isDragging = false;
            
            // Hide letter display after a delay
            setTimeout(hideLetterDisplay, 500);
            
            // Start a timeout to hide the handle
            setTimeout(function() {
                if (!isScrolling) {
                    hideHandleIndicator();
                }
            }, 1500);
        }
        
        // Mouse event handlers
        function handleMouseDown(e) {
            // Only react if handle is visible or we're already dragging
            if (!handleIndicator.classList.contains('visible') && !isDragging) {
                showHandleIndicator();
                // Give a small delay before processing the click
                setTimeout(() => {
                    processMouseDown(e);
                }, 50);
            } else {
                processMouseDown(e);
            }
        }
        
        function processMouseDown(e) {
            e.preventDefault();
            handleIndicator.classList.add('active');
            isDragging = true;
            
            // Get mouse position relative to handle
            const handleRect = alphabetHandle.getBoundingClientRect();
            const y = e.clientY - handleRect.top;
            
            // Update letter based on position
            const index = getLetterIndexFromY(y);
            positionIndicator(index);
            scrollToSection(availableLetters[index]);
            
            // Show letter display
            showLetterDisplay();
        }
        
        function handleMouseMove(e) {
            if (!isDragging) return;
            e.preventDefault();
            
            // Get mouse position relative to handle
            const handleRect = alphabetHandle.getBoundingClientRect();
            const y = e.clientY - handleRect.top;
            
            // Update letter based on position
            const index = getLetterIndexFromY(y);
            positionIndicator(index);
            scrollToSection(availableLetters[index]);
        }
        
        function handleMouseUp(e) {
            if (!isDragging) return;
            handleIndicator.classList.remove('active');
            isDragging = false;
            
            // Hide letter display after a delay
            setTimeout(hideLetterDisplay, 500);
            
            // Start a timeout to hide the handle
            setTimeout(function() {
                if (!isScrolling) {
                    hideHandleIndicator();
                }
            }, 1500);
        }
        
        // Modal Functions
        function openModal(title) {
            modalTitle.textContent = title;
            modalContent.textContent = "Letra del cántico: " + title + "\n\nAquí iría la letra del cántico..."; // Placeholder
            modal.classList.remove('hidden');
            modal.classList.add('modal-fade-in');
            document.body.style.overflow = 'hidden'; // Prevent background scrolling
        }
        
        function closeModal() {
            modal.classList.add('modal-fade-out');
            setTimeout(() => {
                modal.classList.add('hidden');
                modal.classList.remove('modal-fade-in', 'modal-fade-out');
                document.body.style.overflow = ''; // Restore scrolling
            }, 300);
        }
        
        // Audio playback functions
        function toggleMetronome(bpm) {
            alert("Metronome functionality would go here: " + bpm + "bpm");
        }
        
        function stopCurrentAudio() {
            alert("Stop audio functionality would go here");
        }
        
        // Set up event listeners
        function setupEventListeners() {
            // Scroll event
            window.addEventListener('scroll', handleScroll);
            
            // Alphabet handle touch/mouse events
            alphabetHandle.addEventListener('touchstart', handleTouchStart);
            alphabetHandle.addEventListener('touchmove', handleTouchMove);
            alphabetHandle.addEventListener('touchend', handleTouchEnd);
            
            alphabetHandle.addEventListener('mousedown', handleMouseDown);
            document.addEventListener('mousemove', handleMouseMove);
            document.addEventListener('mouseup', handleMouseUp);
            
            // Close modal when clicking outside
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    closeModal();
                }
            });
            
            // Close modal on Escape key
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape' && !modal.classList.contains('hidden')) {
                    closeModal();
                }
            });
        }
        
        // Initialize the app
        document.addEventListener('DOMContentLoaded', () => {
            generateContentList();
            setupSearch();
            setupThemeToggle();
            setupHandle();
            setupEventListeners();
        });
    </script>
</body>
</html>
