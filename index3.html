<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cánticos de Victoria</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Chewy&family=Quicksand:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        // Tailwind Configuration
        tailwind.config = {
            darkMode: 'class',
            theme: {
                fontFamily: {
                    'sans': ['Quicksand', 'sans-serif'],
                    'headings': ['Chewy', 'cursive'],
                },
                extend: {
                    colors: {
                        primary: '#5D5CDE',
                    }
                }
            }
        }

        // Dark mode detection
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.classList.add('dark');
        }
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
            if (event.matches) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        });
    </script>
    <style>
        /* Search highlight */
        .search-highlight {
            background-color: rgba(93, 92, 222, 0.2);
            border-radius: 2px;
            padding: 0 2px;
            margin: 0 -2px;
        }
        
        .dark .search-highlight {
            background-color: rgba(93, 92, 222, 0.4);
        }
    </style>
</head>
<body class="min-h-screen bg-white dark:bg-gray-900 text-gray-800 dark:text-gray-200 transition-colors duration-200">
    <div class="container mx-auto px-4 py-8 max-w-md md:max-w-lg lg:max-w-2xl">
        <!-- App Header -->
        <h1 class="text-4xl md:text-5xl lg:text-6xl font-bold mb-2 text-gray-800 dark:text-gray-200 text-center font-headings">Cánticos de Victoria</h1>
        <p id="subtitle" class="mb-6 text-sm md:text-base lg:text-lg text-gray-600 dark:text-gray-400 text-center">Una colección de coritos</p>
        
        <!-- Search Bar -->
        <div id="searchBarContainer" class="sticky top-0 z-10 bg-white dark:bg-gray-900 pt-2 pb-4 mb-4">
            <div class="relative">
                <input type="text" id="searchInput" class="w-full px-4 py-2 pr-12 border border-gray-300 dark:border-gray-600 rounded-full bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-300 focus:outline-none focus:ring-1 focus:ring-primary focus:border-primary transition-colors text-base md:text-lg" placeholder="Search...">
                <div class="absolute inset-y-0 right-0 flex items-center pr-3 text-gray-400 dark:text-gray-500">
                    <!-- Search icon -->
                    <svg id="searchIcon" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                    </svg>
                    
                    <!-- Clear search icon -->
                    <svg id="clearSearchIcon" xmlns="http://www.w3.org/2000/svg" class="h-7 w-7 hidden cursor-pointer hover:text-gray-600 dark:hover:text-gray-300" fill="none" viewBox="0 0 24 24" stroke="currentColor" onclick="clearSearch()">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </div>
            </div>
            <p id="noResults" class="mt-2 text-center text-red-500 dark:text-red-400 hidden">No se encontraron resultados</p>
            <p id="debugInfo" class="mt-1 text-xs text-gray-500 dark:text-gray-400"></p>
        </div>
        
        <!-- Item List -->
        <ul id="itemList" class="bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden">
            <!-- Items will be populated dynamically -->
        </ul>
        
        <!-- Loading Indicator -->
        <div id="loadingIndicator" class="flex items-center justify-center py-4">
            <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-primary" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
            <span>Loading...</span>
        </div>
    </div>

    <!-- Modal -->
    <div id="modal" class="fixed inset-0 z-50 hidden bg-black bg-opacity-75 flex items-center justify-center p-4">
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-md md:max-w-2xl lg:max-w-3xl w-full max-h-[80vh] flex flex-col overflow-hidden">
            <!-- Modal Header -->
            <div class="px-4 py-3 border-b border-gray-200 dark:border-gray-700 flex justify-between items-center">
                <h3 id="modalTitle" class="text-xl font-bold text-gray-800 dark:text-gray-200"></h3>
                <button id="closeModalBtn" class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200" onclick="closeModal()">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
            
            <!-- Modal Content -->
            <div class="flex-1 overflow-y-auto p-4">
                <p id="modalContent" class="text-gray-800 dark:text-gray-200 text-lg whitespace-pre-line"></p>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let allItems = []; // Store all song items
        let currentSearchTerm = '';
        
        // Sample data for testing
        const sampleData = [
            { title: "Alabanza y adoración", content: "Venimos a adorarte\nCon todo el corazón\nA rendirnos ante ti Señor" },
            { title: "Al Rey de reyes", content: "Al Rey de reyes\nEl Señor de señores\nA él la gloria y el honor\n\nPorque él es Rey, porque él es Señor\nPorque él es digno\nEs digno de honor" },
            { title: "Aleluya Cristo vive", content: "Aleluya Cristo vive\nÉl vive para siempre\nÉl es mi esperanza\n\nCada día me sostiene\nCon él puedo caminar\nCon él puedo caminar" },
            { title: "Bendito sea el Señor", content: "Bendito sea el Señor, Dios poderoso\nQuien fue, quien es, y quien vendrá\nBendito sea el Señor, Dios poderoso\nQuien reina hoy y siempre reinará" },
            { title: "Cordero de Dios", content: "Cordero de Dios\nQue quitas el pecado\nLa maldad del mundo\nTen piedad, ten piedad de mí" },
            { title: "Digno es el Cordero", content: "¡Digno es el Cordero\nQue fue inmolado!\n¡Digno es el Cordero\nDe recibir honor y gloria!" },
            { title: "El gozo del Señor", content: "El gozo del Señor es mi fortaleza\nEl gozo del Señor me da la victoria\nEl gozo del Señor es mi fortaleza\n¡Aleluya, Aleluya!" },
            { title: "Grande es el Señor", content: "Grande es el Señor\nY digno de suprema alabanza\nSu grandeza es insondable\nDe generación en generación\nTus obras alabaré" },
            { title: "Hay poder", content: "Hay poder, poder, sin igual poder\nEn Jesús quien murió\nHay poder, poder, sin igual poder\nEn la sangre que Él derramó" },
            { title: "Incomparable", content: "Incomparable es tu amor\nNo hay nadie como tú\nJesús, mi Salvador\nIncomparable es tu amor" },
            { title: "Jesucristo es el Señor", content: "Jesucristo es el Señor\nEl Señor, el Señor\nJesucristo es el Señor\nÉl es el Rey de reyes" },
            { title: "La alegría del Señor", content: "La alegría del Señor es nuestra fuerza\nLa alegría del Señor es nuestra fuerza\nEs nuestra fuerza, es nuestra fuerza\nLa alegría del Señor es nuestra fuerza" },
            { title: "Mi salvador vive", content: "Mi salvador vive\nÉl vive por siempre\nMi salvador vive\nJesús vive hoy" },
            { title: "No hay nadie como tú", content: "No hay nadie como tú\nNo lo hay, no lo hay\nNo hay nadie como tú\nNadie como tú" },
            { title: "Poderoso Dios", content: "Poderoso Dios\nRey del universo\nEl que Era, que Es y que Será\nEl Alfa y Omega\nPrincipio y Fin\nEl que estaba y estará" },
            { title: "Rey de reyes", content: "Rey de reyes y Señor de señores\nGloria, Aleluya\nRey de reyes y Señor de señores\nGloria, Aleluya" },
            { title: "Santo es el Señor", content: "Santo, santo\nSanto es el Señor\nDios poderoso\nDigno es el Señor" },
            { title: "Tú eres santo", content: "Tú eres santo, santo\nTú eres poderoso\nTú eres digno, digno\nDe toda gloria y honor" },
            { title: "Vine a adorarte", content: "Vine a adorarte\nVine a rendirme\nVine a decir que eres mi Rey\nEres mi Señor" },
            { title: "Yo te busco", content: "Yo te busco\nCon todo el corazón\nEspero en ti\nQuiero conocerte más\n\nYo te busco\nCon todo el corazón\nTe alabaré\nCon todo mi ser" }
        ];

        // Document ready
        document.addEventListener('DOMContentLoaded', function() {
            // Store sample data in global array
            allItems = sampleData.map((item, index) => ({
                id: `item-${index}`,
                title: item.title,
                content: item.content
            }));
            
            // Generate content
            generateContent(allItems);
            
            // Hide loading indicator
            document.getElementById('loadingIndicator').style.display = 'none';
            
            // Set up search event listener
            document.getElementById('searchInput').addEventListener('input', handleSearch);
            
            // Update subtitle
            document.getElementById('subtitle').innerHTML = `Una colección de <strong>${allItems.length}</strong> coritos`;
        });
        
        // Generate content from items
        function generateContent(items) {
            const itemList = document.getElementById('itemList');
            itemList.innerHTML = '';
            
            items.forEach(item => {
                const listItem = document.createElement('li');
                listItem.className = 'py-3 px-4 border-b border-gray-200 dark:border-gray-700 hover:bg-gray-100 dark:hover:bg-gray-700 cursor-pointer';
                listItem.innerHTML = `<span class="block font-medium text-lg">${item.title}</span>`;
                listItem.setAttribute('data-id', item.id);
                
                // Add click event
                listItem.addEventListener('click', function() {
                    openModal(item.title, item.content);
                });
                
                itemList.appendChild(listItem);
            });
        }
        
        // Normalize text for searching (handle Spanish accents)
        function normalizeText(text) {
            if (!text) return '';
            return text
                .toLowerCase()
                .normalize("NFD")                   // Normalize accented characters
                .replace(/[\u0300-\u036f]/g, "")    // Remove diacritics (accents)
                .replace(/ñ/g, "n")                 // Replace ñ with n explicitly
                .replace(/[^\w\s]/g, " ")          // Replace special chars with spaces
                .replace(/\s+/g, " ")              // Normalize multiple spaces
                .trim();                            // Remove leading/trailing whitespace
        }
        
        // Handle search input
        function handleSearch() {
            const searchInput = document.getElementById('searchInput');
            const searchTerm = normalizeText(searchInput.value);
            currentSearchTerm = searchTerm;
            
            // Update the debug info
            updateDebugInfo(searchTerm);
            
            // Toggle icons
            toggleSearchIcons(searchInput.value);
            
            const noResults = document.getElementById('noResults');
            const itemList = document.getElementById('itemList');
            const items = itemList.getElementsByTagName('li');
            
            let visibleCount = 0;
            
            if (searchTerm === '') {
                // Show all items
                for (let i = 0; i < items.length; i++) {
                    const item = items[i];
                    item.classList.remove('hidden');
                    
                    // Reset title text (remove highlighting)
                    const titleSpan = item.querySelector('span');
                    const itemId = item.getAttribute('data-id');
                    const itemData = allItems.find(i => i.id === itemId);
                    if (titleSpan && itemData) {
                        titleSpan.textContent = itemData.title;
                    }
                }
                
                noResults.classList.add('hidden');
                return;
            }
            
            // Search through all items
            for (let i = 0; i < items.length; i++) {
                const item = items[i];
                const itemId = item.getAttribute('data-id');
                const itemData = allItems.find(i => i.id === itemId);
                
                if (!itemData) {
                    item.classList.add('hidden');
                    continue;
                }
                
                const titleSpan = item.querySelector('span');
                const normalizedTitle = normalizeText(itemData.title);
                const normalizedContent = normalizeText(itemData.content);
                
                // Check if title or content contains the search term
                const titleMatches = normalizedTitle.includes(searchTerm);
                const contentMatches = normalizedContent.includes(searchTerm);
                
                if (titleMatches || contentMatches) {
                    item.classList.remove('hidden');
                    visibleCount++;
                    
                    // Update title with highlighting if title matches
                    if (titleMatches && titleSpan) {
                        titleSpan.innerHTML = highlightMatchingText(itemData.title, searchTerm);
                    } else if (titleSpan) {
                        // Just show the regular title for content matches
                        titleSpan.textContent = itemData.title;
                    }
                } else {
                    item.classList.add('hidden');
                }
            }
            
            // Show "no results" message if needed
            noResults.classList.toggle('hidden', visibleCount > 0);
        }
        
        // Highlight matching text
        function highlightMatchingText(text, searchTerm) {
            if (!text || !searchTerm) return text;
            
            // Prepare search pattern
            const normalizedText = normalizeText(text);
            const normalizedSearchTerm = normalizeText(searchTerm);
            
            // Use string operations to find and highlight matches
            let result = '';
            let lastIndex = 0;
            let index = normalizedText.indexOf(normalizedSearchTerm);
            
            // If no match found, return the original text
            if (index === -1) return text;
            
            // Find and highlight all occurrences
            while (index !== -1) {
                // Add text before the match
                result += escapeHTML(text.substring(lastIndex, index));
                
                // Add the highlighted match
                result += `<span class="search-highlight">${escapeHTML(text.substring(index, index + searchTerm.length))}</span>`;
                
                // Move to next position
                lastIndex = index + searchTerm.length;
                index = normalizedText.indexOf(normalizedSearchTerm, lastIndex);
            }
            
            // Add any remaining text
            if (lastIndex < text.length) {
                result += escapeHTML(text.substring(lastIndex));
            }
            
            return result;
        }
        
        // Escape HTML special characters
        function escapeHTML(str) {
            return str
                .replace(/&/g, '&amp;')
                .replace(/</g, '&lt;')
                .replace(/>/g, '&gt;')
                .replace(/"/g, '&quot;')
                .replace(/'/g, '&#039;');
        }
        
        // Toggle search icons
        function toggleSearchIcons(value) {
            const searchIcon = document.getElementById('searchIcon');
            const clearSearchIcon = document.getElementById('clearSearchIcon');
            
            if (value.trim()) {
                searchIcon.classList.add('hidden');
                clearSearchIcon.classList.remove('hidden');
            } else {
                searchIcon.classList.remove('hidden');
                clearSearchIcon.classList.add('hidden');
            }
        }
        
        // Clear search function
        function clearSearch() {
            const searchInput = document.getElementById('searchInput');
            searchInput.value = '';
            handleSearch();
            searchInput.focus();
        }
        
        // Update debug info (for testing)
        function updateDebugInfo(searchTerm) {
            const debugInfo = document.getElementById('debugInfo');
            if (!debugInfo) return;
            
            // Count matches
            let titleMatchCount = 0;
            let contentMatchCount = 0;
            
            allItems.forEach(item => {
                const normalizedTitle = normalizeText(item.title);
                const normalizedContent = normalizeText(item.content);
                
                if (normalizedTitle.includes(searchTerm)) titleMatchCount++;
                else if (normalizedContent.includes(searchTerm)) contentMatchCount++;
            });
            
            debugInfo.textContent = searchTerm ? 
                `Searching for: "${searchTerm}" | Found ${titleMatchCount} title matches, ${contentMatchCount} content-only matches` : 
                '';
        }
        
        // Open modal with title and content
        function openModal(title, content) {
            const modal = document.getElementById('modal');
            const modalTitle = document.getElementById('modalTitle');
            const modalContent = document.getElementById('modalContent');
            
            modalTitle.textContent = title;
            
            // Format content and highlight search terms if any
            if (currentSearchTerm) {
                // Split content by line breaks
                const contentLines = content.split('\n');
                const highlightedLines = contentLines.map(line => 
                    highlightMatchingText(line, currentSearchTerm)
                );
                modalContent.innerHTML = highlightedLines.join('\n');
            } else {
                modalContent.textContent = content;
            }
            
            modal.classList.remove('hidden');
        }
        
        // Close modal
        function closeModal() {
            const modal = document.getElementById('modal');
            modal.classList.add('hidden');
        }
    </script>
</body>
</html>
